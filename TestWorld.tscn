[gd_scene load_steps=8 format=2]

[ext_resource path="res://Particle.tscn" type="PackedScene" id=1]

[sub_resource type="SpatialMaterial" id=1]
albedo_color = Color( 0.152941, 0.45098, 0.137255, 1 )

[sub_resource type="PhysicsMaterial" id=2]

[sub_resource type="GDScript" id=3]
script/source = "extends RigidBody

# Declare member variables here. Examples:
var vel3 = Vector3.ZERO
export var fmass = 1.3

# Called when the node enters the scene tree for the first time.
func _ready():
	pass # Replace with function body.


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	# assume for now all particles are the same mass so i just pick a
	# value for G*m1*m2
	var gmm = 5.0
	
	var overlapping = $InfluenceArea.get_overlapping_bodies()	
	var totalInstAcc = Vector3.ZERO;
	
	for body in overlapping:
		if body != self: #not myself lol
			var bodylist = [body.global_transform.origin]
			if body.is_in_group(\"Muscle\"):
				bodylist = body.get_offsets()
				for body3 in bodylist:
					var rsq = self.global_transform.origin.distance_squared_to(body3)
					var r3 = self.global_transform.origin.direction_to(body3)
					
					var acc3 = r3 * (body.fmass * self.fmass)/(rsq)
					totalInstAcc -= acc3 #repel the middle of the muscle
				
			var biggestEffect = Vector3.ZERO
			for body3 in bodylist:
				var rsq = self.global_transform.origin.distance_squared_to(body3)
				var r3 = self.global_transform.origin.direction_to(body3)
				var acc3 = r3 * (gmm * body.fmass * self.fmass)/(rsq)
				if acc3.length_squared() > biggestEffect.length_squared():
					biggestEffect = acc3
				
			totalInstAcc += biggestEffect
	self.add_central_force(totalInstAcc)
	pass

"

[sub_resource type="SpatialMaterial" id=4]
albedo_color = Color( 0.152941, 0.45098, 0.137255, 1 )

[sub_resource type="BoxShape" id=5]

[sub_resource type="SpatialMaterial" id=6]
albedo_color = Color( 0.054902, 0.027451, 0.207843, 1 )

[node name="TestWorld" type="Spatial"]

[node name="Particle" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -6.66432, 2.31354, 4.11821 )

[node name="Particle2" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.08465, 2.31354, 4.11821 )

[node name="Particle3" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1.78079, 2.31354, 4.11821 )

[node name="Particle5" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.07388, 2.31354, 2.05095 )

[node name="Particle6" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.08465, 2.31354, 2.05095 )

[node name="Particle7" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1.78079, 2.31354, 2.05095 )

[node name="Particle25" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -5.51927, 3.78754, 4.11821 )

[node name="Particle26" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2.9396, 3.78754, 4.11821 )

[node name="Particle28" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 6.53704, 3.78754, 3.49227 )

[node name="Particle29" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2.92883, 3.78754, 2.05095 )

[node name="Particle30" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2.9396, 3.78754, 2.05095 )

[node name="Particle9" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.29055, 2.31354, 5.27596 )

[node name="Particle10" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1.71088, 2.31354, 5.27596 )

[node name="Particle11" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2.61113, 2.31354, 5.27596 )

[node name="Particle13" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.29055, 2.31354, 3.2087 )

[node name="Particle14" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1.71088, 2.31354, 3.2087 )

[node name="Particle15" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2.61113, 2.31354, 3.2087 )

[node name="Particle17" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.29055, 3.79631, 5.27596 )

[node name="Particle18" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1.71088, 3.79631, 5.27596 )

[node name="Particle21" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.29055, 3.79631, 3.2087 )

[node name="Particle22" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1.71088, 3.79631, 3.2087 )

[node name="Particle24" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 5.17533, 3.79631, 2.58276 )

[node name="Particle33" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.29055, 3.70281, 4.32898 )

[node name="Particle34" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1.71088, 3.70281, 4.32898 )

[node name="Particle37" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.29055, 3.70281, 2.26172 )

[node name="Particle38" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1.71088, 3.70281, 2.26172 )

[node name="Particle46" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2.75678, 5.18558, 2.26172 )

[node name="Body" parent="Particle46" index="1"]
material = SubResource( 1 )

[node name="Particle47" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 4.06146, 5.18558, 2.26172 )
physics_material_override = SubResource( 2 )
script = SubResource( 3 )
fmass = 2

[node name="Body" parent="Particle47" index="1"]
material = SubResource( 4 )

[node name="Particle48" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 5.17533, 5.18558, 1.63578 )

[node name="Particle49" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -9.01934, 2.31354, -5.79587 )

[node name="Particle50" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -6.43967, 2.31354, -5.79587 )

[node name="Particle51" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.13581, 2.31354, -5.79587 )

[node name="Particle52" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.65304, 2.31354, -5.79587 )

[node name="Particle53" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -6.42891, 2.31354, -7.86313 )

[node name="Particle54" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -6.43967, 2.31354, -7.86313 )

[node name="Particle55" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.13581, 2.31354, -7.86313 )

[node name="Particle56" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.65304, 2.31354, -7.86313 )

[node name="Particle57" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -7.87429, 3.78754, -5.79587 )

[node name="Particle58" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -5.29462, 3.78754, -5.79587 )

[node name="Particle59" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2.99076, 3.78754, -5.79587 )

[node name="Particle60" parent="." instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.917559, 3.78754, -5.79587 )

[node name="Camera" type="Camera" parent="."]
transform = Transform( 1, 0, 0, 0, 0.838652, 0.544668, 0, -0.544668, 0.838652, -1, 10.3466, 18.3813 )

[node name="StaticBody" type="StaticBody" parent="."]
collision_layer = 16
collision_mask = 0

[node name="CollisionShape" type="CollisionShape" parent="StaticBody"]
transform = Transform( 14, 0, 0, 0, 1, 0, 0, 0, 14, 0, 0, 0 )
shape = SubResource( 5 )

[node name="CSGBox" type="CSGBox" parent="StaticBody"]
material_override = SubResource( 6 )
width = 30.0
height = 1.0
depth = 30.0

[node name="Generic6DOFJoint" type="Generic6DOFJoint" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.620339, 5.65943, 2.3847 )
nodes/node_a = NodePath("../Particle46")
nodes/node_b = NodePath("../Particle47")
linear_limit_x/upper_distance = -5.0
linear_limit_x/lower_distance = 5.0
linear_spring_x/enabled = true
angular_limit_x/upper_angle = 90.0
angular_limit_x/lower_angle = 90.0
linear_limit_y/enabled = false
angular_limit_y/upper_angle = 90.0
angular_limit_y/lower_angle = 90.0

[editable path="Particle46"]
[editable path="Particle47"]
